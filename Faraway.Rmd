---
html_document: default
author: "Harry Woo"
date: "2020-5-12"
output:
  html_document:
    df_print: paged
  latex_engine: xelatex
  pdf_document: null
  word_document: default
mainfont: NanumGothic
html_notebook: default
title: "Faraway"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

## Chapter 2 Estimation
## Problem 1

_The dataset teengamb concerns a study of teenage gambling in Britain. Fit a regression model with the expenditure on gambling as the response and the sex, status, income and verbal score as predictors. Present the output._

```{r load packages, include=FALSE}

library(faraway)
library(ggplot2)
library(dplyr)
library(knitr)
library(pander)
library(gt)
library(officer)
library(flextable)

```

```{r teengamb-model-fitting}

data(teengamb)
head(teengamb)

tg_lm <-  lm(gamble ~ sex + status + income + verbal, data = teengamb)
tg_lms <- summary(tg_lm)
print(tg_lms)

```

### (a) What percentage of variation in the response is explained by these predictors? 

전체 제곱합(SST)에서 회귀 제곱합(SSR)이 설명하는 비중, 즉 모형의 설명력은 결정 계수 R^2^ 이다. 위 Summary 에서와 같이 동 모형의 결정계수 **Multiple R-squared = 0.5267** 이다. 

```{r chap2-problem-1-a}

var_ex <- data.frame(Var_explained = tg_lms$r.squared)
var_ex %>% gt() %>% 
  fmt_percent(columns = vars(Var_explained),
              decimals = 2)

```

### (b) Which observation has the largest (positive) residual? Give the case number. 

회귀모형의 `residuals` 를 데이터프레임으로 변환하여 잔차값 기준으로 내림차순 정렬을 시행해 largest residual의 case number를 추출한 결과, **해당 case number는 24** 이다. 

```{r chap2-problem-1-b}

res <- data.frame(case_no = c(1:47), residual = tg_lm$residuals)
res %>% 
  arrange(desc(residual)) %>% 
  slice(1) %>% 
  gt()

```

### (c) Compute the mean and median of the residuals. 

. 

```{r chap2-problem-1-c}

res %>% 
  summarise(mean = mean(residual), median = median(residual)) %>% 
  gt()

```

### (d) Compute the correlation of the residuals with the fitted values. 

. 

```{r chap2-problem-1-d}

data.frame(correlation = cor(tg_lm$residuals, tg_lm$fitted.values)) %>% 
  gt()


```

### (e) Compute the correlation of the residuals with the income. 

. 

```{r chap2-problem-1-e}

data.frame(correlation = cor(teengamb$income, tg_lm$fitted.values)) %>% 
  gt()


```

### (f) For all other predictors held constant, what would be the difference in predicted expenditure on gambling for a male compared to a female? 

. 

```{r chap2-problem-1-f}

data.frame(Gender_coef = tg_lm$coefficients["sex"]) %>% 
  gt()


```

## Chapter 3 Interference
## Problem 1

_For the prostate data, fit a model with lpsa as the response and the other variables as predictors._

```{r prostate-model-fitting}

data(prostate)
head(prostate)

ps_lm <- lm(lpsa ~ lcavol + lweight + age + lbph + svi + lcp + gleason + pgg45, data = prostate)
summary(ps_lm)

```

### (a) Compute 90 and 95% CIs for the parameter associated with age. Using just these intervals, what could we have deduced about the p-value for age in the regression summary?
 
/

```{r chap3-problem-1-a}


```

### (b) Compute and display a 95% joint confidence region for the parameters associated with age and lbph. Plot the origin on this display. The location of the origin on the display tells us the outcome of a certain hypothesis test. State that test and its outcome.

/

```{r chap3-problem-1-b}



```

### (c) Suppose a new patient with the following values arrives:

`data.framelcavol lweight age Ibph svi lcp
1.44692 3.62301 65.00000 0.30010 0.00000 -0.79851
gleason pgg45
7.00000 15.00000

### Predict the lpsa for this patient along with an appropriate 95% CI.

/

```{r chap3-problem-1-c}


```


### (d) Repeat the last question for a patient with the same values except that he or she is age 20. Explain why the CI is wider.

/

```{r chap3-problem-1-d}


```


### (e) In the text, we made a permutation test corresponding to the F-test for the significance of all the predictors. Execute the permutation test corresponding to the t-test for age in this model. (Hint: {summary (g) $coef [4,3] gets you the t-statistic you need if the model is called g.)

/

```{r chap3-problem-1-e}


```




